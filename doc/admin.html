<html><!-- #BeginTemplate "/Templates/docpage.dwt" --><!-- DW6 --><head><!-- #BeginEditable "doctitle" --> <title>GDS Administrator's Guide</title><!-- #EndEditable --> <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><style type="text/css"><!--code {  font-family: "Courier New", Courier, mono; font-size: 12pt}body {  font-family: Arial, Helvetica, sans-serif; font-size: 12pt}h2 {  font-size: 14pt}td {  font-family: Arial, Helvetica, sans-serif; font-size: 12pt}h1 {  font-size: 16pt}--></style></head><body bgcolor="#FFFFFF" link="#0000FF" vlink="#000099" alink="#009900"><table width="100%" border="1" bordercolor="#FFFFFF" cellpadding="10" cellspacing="10">  <tr bordercolor="#DDDDDD">     <td>      <h1 align="center"><!-- #BeginEditable "title" -->GrADS-DODS Server - Administrator's         Guide<!-- #EndEditable --></h1>    </td>  </tr></table><table width="100%" border="1" bordercolor="#FFFFFF" cellpadding="10" cellspacing="10">  <tr bordercolor="#DDDDDD">     <td><!-- #BeginEditable "body" -->       <h2>Table of Contents </h2>      <ul>        <li><a href="admin.html#1"><b>Installation</b></a>           <ul>            <li><a href="admin.html#1a">Requirements</a></li>            <li><a href="admin.html#1b">Downloading and setup</a></li>            <li><a href="admin.html#1c">Putting your datasets online</a> <br>              <b><br>              </b></li>          </ul>        </li>        <li><b><a href="admin.html#2">Controlling the server</a></b><ul>            <li><a href="admin.html#2a">Starting and stopping</a></li>            <li><a href="admin.html#2b">Web-based administration</a></li>            <li><a href="admin.html#2c">Checking the server status</a><br>              <b><br>              </b></li>          </ul>        </li>        <li><b><a href="admin.html#3">Configuration</a> </b>           <ul>            <li><a href="admin.html#3a">Startup parameters</a></li>            <li><a href="admin.html#3b">Configuration file settings</a></li>            <li><a href="admin.html#3c">Tomcat settings</a></li>            <li><a href="admin.html#3d">Security</a><br>              <b><br>              </b></li>          </ul>        </li>        <li><b><a href="admin.html#4">Advanced topics</a> </b>           <ul>            <li><a href="admin.html#4a">Static web pages</a></li>            <li><a href="admin.html#4b">Integrating with Apache</a></li>            <li><a href="admin.html#4c">Deploying to a different servlet container</a></li>            <li><a href="admin.html#4d">Building from source</a></li>          </ul>        </li>      </ul>      <hr>      <h2><b><a name="1"></a></b>Installation </h2>      <p><b><a name="1a"></a>Requirements</b></p>      <p>The GDS can run on any UNIX platform for which both Java and GrADS are         available. </p>      <p>You will need a Java Virtual Machine (JVM) that supports Java 1.3 or         higher. Enter <code>java -version</code> at the Unix command prompt to         find out what JVM you have currently installed on your system. The Java         Virtual Machine is a free download either from <a href="http://java.sun.com">Sun         Microsystems</a>, or your operating system manufacturer's website. </p>      <p>You will also need GrADS. Because the server uses some new features in         GrADS, you will need version 1.8 or higher. Handling station data and         client uploads requires version 1.9 or higher. GDS version 2.0 requires GrADS 2.0.a3 or higher. The latest version of GrADS         is available at the <a href="http://cola.gmu.edu/grads/">GrADS home page</a>.</p>      <p><a href="#">return to table of contents</a></p>      <p>&nbsp;</p>      <p><b><a name="1b"></a>Download and setup</b></p>      <p>The latest version of the GDS is available at the <a href="http://cola.gmu.edu/grads/gds">GDS         home page</a> as a compressed tar archive.</p>      <p> You do not need root user access to run the GDS. There is no build or         system install process, because it is a cross-platform Java application.         And any number of GDSes can be run on the same system, as long as they         are configured to use different ports (see <a href="#tomcat">Tomcat settings</a>).      </p>      <p>After unpacking the archive, all you need to do is edit the <a href="#3b">configuration         file</a>, and tell the GDS where to find GrADS, by editing the <a href="tag-ref.html#invoker"><code>&lt;invoker&gt;</code></a>         tag. If you are not using a full GrADS distribution, make sure the GrADS         executable you specify is capable of opening the types of dataset you         wish to use. </p>      <p>Next, double check with other users and/or your system administrator,         to make sure that port settings for the GDS do not conflict with ports         that are already in use. By default the GDS uses ports 9090 and 9095.         See <a href="#tomcat">Tomcat settings</a> for instructions on how to change         these.</p>      <p>At this point, you should be able to start the server and view the example         dataset. </p>      <p>If you plan to serve netCDF, HDF, or OPeNDAP data sets, also make sure that the         <code>GADDIR</code> environment variable in the GDS startup shell points         to the location of the GrADS supplementary data files (available from         the GrADS <a href="http://cola.gmu.edu/grads/downloads.html">download         page</a>). In particular, the file <code>udunits.dat</code> must be present         in this directory, since it is needed for COARDS metadata processing.         If <code>GADDIR</code> is not set, this error will occur:</p>      <p><code>error: can't import <em>dataset_name</em>; metadata extraction         failed for <em>dataset_file</em>; couldn't open <em>dataset_file</em></code></p>      <p>when the GDS tries to access any netCDF, HDF or DODS data.</p>      <p><a href="#">return to table of contents</a> </p>      <p>&nbsp;</p>      <p><b><a name="1c"></a>Putting your datasets online</b></p>      <p>Next you will want to put your data online. </p>      <p>First, make sure that all of your datasets are ready to be opened by         GrADS. If you have COARDS-compliant NetCDF data, they are ready to go         as is. Otherwise, you may need to generate some CTL and/or map files.         See the <a href="http://cola.gmu.edu/grads/gadoc/">GrADS documentation</a>         for more information on how GrADS works with various data formats. </p>      <p>Once this is done, all you need to do to put your datasets online is         tell the GDS where they are, using the configuration file. This is done         by adding <a href="tag-ref.html#dataset"><code>&lt;dataset&gt;</code></a>,         <a href="tag-ref.html#datadir"><code>&lt;datadir&gt;</code></a>, and<code>         <a href="tag-ref.html#datalist">&lt;datalist&gt;</a></code> tags inside         the <a href="tag-ref.html#data"><code>&lt;data&gt;</code></a> tag. If         you want, you can organize the way the data appear online using <a href="tag-ref.html#mapdir"><code>&lt;mapdir&gt;</code></a>         tags.</p>      <p>Note that the GDS does not attempt to access datasets until the first         time they are requested by a client, so it may not immediately complain         about unusable datasets. Before you invite others to use your server,         therefore, it is a good idea to make sure that all of the datasets you         are serving work properly, by opening them in your own OPeNDAP-enabled client.      </p>      <p>Once you have your data loaded and working, it is highly recommended         that you familiarize yourself with the configuration options and administrative         tools available by reading the remainder of this documentation.</p>      <p><a href="#">return to table of contents</a> </p>      <p>&nbsp;</p>      <p><b><a name="1d" id="1d"></a>Serving real-time or frequently updated data</b></p>      <p>An important warning for serving changing collections of data, such as         real-time observations:</p>      <p><em>Always post new or modified data under new handles</em>. <em>Never         modify the contents of an existing dataset</em>. </p>      <p>Many OPeNDAP clients work on the assumption that the dataset they are making         requests from will not change. If it does, they may behave erratically,         or worse, return the wrong data values to the user. The user may not even         realize this has happened. </p>      <p>For example, if you add new model run data daily, use an absolute date,         eg. <code>01mar2003</code>, in the data file names. Once you have posted         the data for March 1, 2003, you can leave it as is until you take it offline         or move it to another archive; the next day's data can be posted as <code>02mar2003</code>.         Then, anybody using the March 1data will be unaffected when you post your         March 2 data. </p>      <p>By contrast, if you were to use relative times - e.g., post March 1 data         as <code>data.today</code>, and then at some point update <code>data.today</code>         to point to March 2 data instead - anyone working with the dataset when         you switched it would either suddenly receive error messages without explanation,         or worse, would start receiving the data for March 2, believing it was         for March 1. The OPeNDAP system has no way of indicating to the client that         the contents of <code>data.today</code> have moved to <code>data.yesterday</code>,         and <code>data.today</code> has been replaced with an entirely different         dataset. </p>      <p>The one exception is that it is safe to simply extend the time dimension         of a dataset, as long as you keep the origin (t=0) time of the dataset         the same. This will not cause any problems for clients unaware of the         change, as all data requests in the older time ranges will still return         the same data as before the change. </p>      <p><a href="#">return to table of contents</a> </p>      <p>&nbsp;</p>      <hr>      <h2><b><a name="2"></a></b>Controlling the server<br>      </h2>      <p><b><a name="2a"></a>Starting and stopping</b></p>      <p>There are four scripts in the server home directory that are used to         control the GDS, which send brief messages to the terminal, and record         their actions in more detail in the file <code>log/console.out</code>.</p>      <p><code>startserver</code> - Starts a background task, which runs GDS,         and will respawn it if the process dies, until stopserver is run.</p>      <p> <code>stopserver</code> - Shuts down the GDS, preventing the process         from respawning. </p>      <p> <code>rebootserver</code> - Restarts the GDS.</p>      <p> <code>cleanup</code> - Restarts the GDS, clearing all temporary data         such as cached metadata, analysis results, and blocked IP addresses. </p>      <p>These now invoke the corresponding scripts in the bin directory, which         have been completely rewritten: </p>      <p><code>bin/gds-start.sh<br>        bin/gds-stop.sh<br>        bin/gds-cleanup.sh</code></p>      <p>The behavior of these scripts is similar to the old startup scripts,         but there are some major improvements. </p>      <p>Firstly, they can now be run from any directory; it is not necessary         to <code>cd</code> to the GDS home directory first. </p>      <p>Second, to reduce the chance of downtime, <code>gds-start.sh</code> creates         a process called <code>gds-respawn.sh</code>, which stays running, and         attempts to restart Tomcat if it dies unexpectedly. To test this, you         can kill the Tomcat process with a KILL signal - gds-respawn.sh will think         it has crashed, and attempt to restart it. Note that this does not apply         to the TERM signal, which should give Tomcat a chance to shut itself down         properly. </p>      <p>Third, gds-start.sh now waits until the GDS is ready to handle requests         before exiting, and exits with a non-zero return code if the server fails         to start. This allows reliable scripting of follow-on commands which require         the GDS to be running, without the need for kludges such as <code>sleep         </code>commands or retrieving test pages with a utility like <code>curl</code>.      </p>      <p><a href="#">return to table of contents</a></p>      <p>&nbsp;</p>      <p><b><a name="2b"></a>Web-based administration</b></p>      <p>The GDS has a web-based administration interface which is accessed by         URLs of the form:</p>      <p><code>http://<em>localhost</em>:9090/dods/admin?auth=<em>authorization_string</em>&amp;cmd=<em>command_string</em></code>      </p>      <p>The <code><em>authorization_string</em></code> given must match the <code>auth</code>         setting given in the <a href="tag-ref.html#service"><code>&lt;service-admin&gt;</code></a>         configuration tag. The <code>command_string</code> can be one of the following:</p>      <p><code>reload</code>: Checks for changes to the server configuration.         This updates the data catalog, privilege sets, and all other settings         contained in the GDS configuration file, without the need to take the         server offline.</p>      <p><code>clear</code>: Removes all temporary entries from the catalog.</p>      <p>The authorization string can be kept from appearing in the log files         by using POST rather than GET requests to perform administration tasks.         There is a form which can be used to do this, at :</p>      <p><code>http://<em>machinename</em>:9090/admin.html</code></p>      <p>Alternately, a utility such as <code>curl</code> can be configured to         send the appropriate POST data, which should consist of the portion of         the URL that comes after the <code>?</code>, i.e.:</p>      <p><code>auth=<em>authorization_string</em>&amp;cmd=<em>command_string</em></code></p>      <p>For convenience, there is a script called <code>gds-reload.sh</code>         in the utils directory, which will extract the authorization string from         <code>gds.xml</code>, and make a POST request using <code>curl</code>,         to trigger a configuration update. This script will run as is on many         platforms, and should be easy to customize if needed.</p>      <p>By default, the administration utility can only be invoked through the         local network interface; that is, it will only accept requests originating         from IP address 127.0.0.1. Additional IP addresses can be allowed to make         administration requests by using the <em>admin_enabled</em> attribute         of the <a href="tag-ref.html#privilege">&lt;privilege&gt;</a> tag.</p>      <p>Because they alter the state of internal structures, administration commands         can only run while the server is idle. The administration service has         a <em>timeout</em> attribute which controls the length of time it will         wait for the server to become idle. If this time expires, it will return         with an error message, and the command will not be performed.</p>      <p>Except under very heavy loads, this should not be an issue, as even a         momentary idle is sufficient. However, on certain systems, it appears         that normal data requests can occasionally get &quot;hung&quot; in the         middle of transmission, and never finish. This will prevent administrative         commands from running, because the server can't consider itself to be         idle until all outstanding requests are complete. The cause for this problem         is under investigation and it will hopefully be resolved soon; however,         in the meantime, it is advisable when scripting the administrative command,         to include a fallback to a restart of the server, should the administrative         command time out more than once.</p>      <p><a href="#">return to table of contents</a></p>      <p>&nbsp;</p>      <p><b><a name="2c"></a>Checking the server status<br>        </b></p>      The script <code>check_gds</code>, found in the servers' home directory,       can be used to notify the administrator by email and automatically restart       a GDS if it goes offline. This script requires the <a href="http://lynx.isc.org/">lynx</a>       web browser, or some other command-line utility that can download documents       via HTTP.       <p>To use the script, edit it to use the base URL and home directory of         the server it is to check, and add it as a cron job with the desired frequency.         Once in the crontab, the script can be temporarily disabled by placing         a file called <code>block_check_gds</code> in the home directory of the         GDS being checked.</p>      <p>You can also use the <code>ps</code> command to check on the server processes.         The file <code>temp/tomcat.pid</code> contains the server's current process         ID, if any.</p>      <p><a href="#">return to table of contents</a></p>      <p><br>      </p>      <hr>      <h2><b><a name="3"></a></b>Configuration </h2>      <p><b><a name="3a"></a>Startup parameters</b></p>      <p>The GDS startup shell uses the values of several environment variables         if present. These are: </p>      <p><code>JAVA</code> - The command GDS should use to start the Java Virtual         Machine</p>      <p><code>JAVA_HOME</code> - The location of a complete Java installation.         If set, GDS will use the command <code>$JAVA_HOME/bin/java</code> to start         the Java Virtual Machine. <br>        <br>        If <code>JAVA</code> is set, <code>JAVA_HOME</code> does nothing. If neither         <code>JAVA</code> nor <code>JAVA_HOME</code> is set, GDS will simply use         the command<code> java</code> to start the Java Virtual Machine, assuming         that the executable is in the system path.</p>      <p><code>JAVA_OPTS</code> - Arguments to use when starting the Java Virtual         Machine for Tomcat. If not set, the default is <code>-server</code>. </p>      <p><code>ANAGRAM_HOME</code> - Location of the GDS support files(Anagram         is the generic framework used to implement the GDS). By defaults this         is the directory above where <code>gds-start.sh</code> is located. GDS         expects the support files in <code>scripts/</code> and <code>bin/</code>         to be present, and must be able to write to the <code>temp/</code> and         <code>log/</code> subdirectories as well.</p>      <p><code>ANAGRAM_CONFIG </code>- Location of the XML configuration file         that GDS should use, relative to <code>$ANAGRAM_HOME</code>. By default         this is <code>gds.xml</code></p>      <p class="item10"><a href="#">return to table of contents</a></p>      <p class="item10">&nbsp;</p>      <p class="item10"><b><a name="3b"></a>Configuration file settings</b></p>      <p class="item10">The GDS derives settings for all of its modules from an         XML configuration file. The name of this file is specified at startup;         the default is <code>gds.xml</code>. This file is read every time the         server starts, and every time a <code>reload</code> command is given using         the <a href="#web">administrative web interface</a>. </p>      <p class="item10">The <a href="tag-ref.html">configuration file reference</a>         describes the XML tags that can be used in this file.</p>      <p><a href="#">return to table of contents</a></p>      <p>&nbsp;</p>      <p><b><a name="3c"></a>Tomcat settings</b></p>      <p class="item10"><span class="code">Note that the pre-configured Tomcat         bundled with the GDS is now version 4.1, and is located in the directory         <code>tomcat4/</code>, rather than <code>tomcat/</code>.</span></p>      <p class="item10"><span class="code"><span class="item10">The configuration         file for Tomcat is <span class="code"><code>tomcat4/conf/server.xml</code></span>.         This file can be edited to </span></span><span class="code"><span class="item10">change         the network port that the GDS runs on, and to increase the size of the         connection pool, among other things. </span></span></p>      <p><em>Warning: if two or more Tomcat servers on the same machine are trying         to use the same port settings, the startup and shutdown commands will         affect both servers unpredictably, and only one of them will actually         be able to handle requests.</em> </p>      <p>If your server is shutting down unexpectedly, not starting up, or not         responding to the &quot;<code>stopserver</code>&quot; script, check whether         you or another user are trying to run a second Tomcat server, with the         same port settings. </p>      <p class="item10"><span class="code"><span class="item10">An explanation         of Tomcat and the settings in its configuration file can be found at the         <a href="http://jakarta.apache.org/tomcat/index.html">Tomcat home page</a></span></span></p>      <p class="item10"><a href="#">return to table of contents</a></p>      <p class="item10">&nbsp;</p>      <p class="item10"><b><a name="3d"></a>Security</b> </p>      <p class="item10">Both Tomcat and the GrADS-DODS Server support IP-address-based         security. Each can be given its own security settings. Tomcat will allow         or deny access to the server based on the settings in its configuration         files. For finer grained control, use the <a href="tag-ref.html#ip_range"><code>&lt;ip_range&gt;</code></a>         and<code> <a href="tag-ref.html#privilege">&lt;privilege&gt;</a></code>         tags in the GDS configuration file. These settings allow or deny access         to specific datasets and server features. </p>      <p><a href="#">return to table of contents</a></p>      <p>&nbsp; </p>      <hr>      <h2><b><a name="4"></a></b>Advanced Topics</h2>      <p><b><a name="4a"></a>Static web pages</b></p>      <p>The GDS comes with some static web pages which can be accessed using         Tomcat (including this manual). These pages are located in the subdirectory         <code>tomcat4/webapps/ROOT</code>. In general, putting your static content         on a separate web server is recommended, since will usually be more efficient         than using Tomcat for this. However, Tomcat's static content directory         provides an easy way to put up some information about the datasets you         are serving, without setting up a separate web server.</p>      <p><a href="#">return to table of contents</a></p>      <p>&nbsp;</p>      <p><b><a name="4b"></a>Integrating with Apache</b></p>      <p>The GDS can fairly easily be integrated into an existing Apache web site.         All that is required is to set up the link between Tomcat and Apache.         Consult the <span class="code"><span class="item10"><a href="http://jakarta.apache.org/tomcat/index.html">Tomcat         home page</a></span></span><b></b> for more on this process.</p>      <p><a href="#">return to table of contents</a></p>      <p>&nbsp;</p>      <p><b><a name="4c"></a>Deploying to a different servlet container</b></p>      <p>It is not necessary to use the copy of Tomcat that is distributed with         the GDS, to run the GDS. Any servlet container that supports the Java         Servlet API 2.2 or higher can be used. </p>      <p>The GDS web application is in the directory <code>tomcat/webapps/dods</code>.         You can generate a Web Application archive (WAR) file by changing to <code>src/</code>         and running the <code>makewar</code> script . This will generate an archive         called<code> dods.war</code>. To add the WAR to your servlet container,         follow the servlet container's instructions. </p>      <p>Once you have added it, you will need to set the property <code>anagram.home</code>         to the directory containing the rest of the GDS distribution. This can         be set either as a Java system property (using the <code>-d</code> switch         when invoking Java) or as a servlet context property (follow the servlet         container's instructions). </p>      <p><a href="#">return to table of contents</a></p>      <p>&nbsp;</p>      <p><b><a name="4d"></a>Building from source</b></p>      <p>Source code is included with the GDS, under the path <code>src/</code>.      </p>      <ul>        <li>To generate Java documentation from the source code, change to <code>src/</code>           and run the <code>makedoc</code> script.The documentation will be placed           in <code>src/doc/</code>.<br>          <br>        </li>        <li>To recompile the source code, change to <code>src/</code> and run           the <code>makejar</code> script. <br>        </li>      </ul>      <p><a href="#">return to table of contents</a></p>      <!-- #EndEditable --> </td>  </tr></table></body><!-- #EndTemplate --></html>